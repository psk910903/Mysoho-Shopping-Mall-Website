<!DOCTYPE html>
<html
        xmlns:th="http://www.thymeleaf.org"
        xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>마이소호 샘플샵</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <link rel="stylesheet" href="/css/header.css" />
    <link rel="stylesheet" href="/css/navbar.css" />
    <link rel="stylesheet" href="/css/footer.css" />
    <link rel="stylesheet" href="/css/option-popup.css" />
    <link rel="stylesheet" href="/css/share-btn.css" />
    <link rel="stylesheet" href="/css/product.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/js/all.min.js"></script>
  </head>
  <body>
    <script src="https://code.jquery.com/jquery-3.6.3.min.js"></script>
    <div class="wrap">
      <div class="betweenbtn">
        <div th:replace="/fragments/betweenbtn.html :: fragment-betweenbtn"></div>
      </div>
      <div class="betweenbtn2">
        <div th:replace="/fragments/betweenbtn2.html :: fragment-betweenbtn2"></div>
      </div>
      <div class="header-wrap">
        <div class="header">
          <div th:replace="/fragments/header.html :: fragment-header"></div>
        </div>
        <div class="navbar">
          <ul>
            <li><a href="/plan/item/SALE">♡ NURIRI SALE ♡</a></li>
            <li><a href="/plan/item/TOP">TOP</a></li>
            <li><a href="/plan/item/BOTTOM">BOTTOM</a></li>
            <li><a href="/plan/item/ONE-PIECE">ONE-PIECE</a></li>
            <li><a href="/plan/item/ACC" id="acc">ACC</a></li>
          </ul>
        </div>
      </div>
      <!--  -->
      <div>
        <!--content header-->
        <div
                th:replace="/user/product-object/container-product-content-header.html :: container-product-content-header"
        ></div>
        <!--  content -->
        <div class="pop-page odr-detail">
          <div
                  th:replace="/user/product-object/container-product-content-nav.html :: container-product-content-nav"
          ></div>

          <div class="txt-detail">
            <div class="buyBtn-hidden">
              <button type="button" onclick="processBeforeSubmit()"
                      class="js-mo-tpl btn-h42-gray mt-25"
                      id="buyBtn"
                >결제하기</button
              >
              <div
                      th:replace="/user/product-object/container-product-content-info.html :: container-product-content-info"
              ></div>
              <!-- 후기 내용 (display none) -->
              <div class="page2">
                <div id="reviewTab" class="tab-cont">
                  <div class="estimate-wrap">
                    <div class="estimate-point">
                      <div class="stars js-reviewGradeAvgStar">
                        <!-- 별점 -->
                        <!--테스트1-->
                        <div class="reviewStarRating">
                          <div class="rating1" th:value="${avgStar}" value="3.9">
                            <div class="star-wrap1"><div class="star1"><i  ><img src="https://image.makeshop.co.kr/mysoho/assets/shop/img/common/review_big_star_on.png" alt="" height="27px" width="27px"></i></div></div>
                            <div class="star-wrap1"><div class="star1"><i  ><img src="https://image.makeshop.co.kr/mysoho/assets/shop/img/common/review_big_star_on.png" alt="" height="27px" width="27px"></i></div></div>
                            <div class="star-wrap1"><div class="star1"><i  ><img src="https://image.makeshop.co.kr/mysoho/assets/shop/img/common/review_big_star_on.png" alt="" height="27px" width="27px"></i></div></div>
                            <div class="star-wrap1"><div class="star1"><i  ><img src="https://image.makeshop.co.kr/mysoho/assets/shop/img/common/review_big_star_on.png" alt="" height="27px" width="27px"></i></div></div>
                            <div class="star-wrap1"><div class="star1"><i  ><img src="https://image.makeshop.co.kr/mysoho/assets/shop/img/common/review_big_star_on.png" alt="" height="27px" width="27px"></i></div></div>
                          </div>
                          <div class="rating2" >
                            <div class="star-wrap2"><div class="star2"><i  ><img  src="https://image.makeshop.co.kr/mysoho/assets/shop/img/common/review_big_star_on.png" alt="" height="27px" width="27px"></i></div></div>
                            <div class="star-wrap2"><div class="star2"><i  ><img  src="https://image.makeshop.co.kr/mysoho/assets/shop/img/common/review_big_star_on.png" alt="" height="27px" width="27px"></i></div></div>
                            <div class="star-wrap2"><div class="star2"><i  ><img  src="https://image.makeshop.co.kr/mysoho/assets/shop/img/common/review_big_star_on.png" alt="" height="27px" width="27px"></i></div></div>
                            <div class="star-wrap2"><div class="star2"><i  ><img  src="https://image.makeshop.co.kr/mysoho/assets/shop/img/common/review_big_star_on.png" alt="" height="27px" width="27px"></i></div></div>
                            <div class="star-wrap2"><div class="star2"><i  ><img  src="https://image.makeshop.co.kr/mysoho/assets/shop/img/common/review_big_star_on.png" alt="" height="27px" width="27px"></i></div></div>
                          </div>
                        </div>
                        <!--  -->
                        <!--  -->
                        <!--  -->
                        <script>
                var rating1 = $('.rating1');

                rating1.each(function(){
                  var $this = $(this);
                    var targetScore = $this.attr('value');
                    var firstDigit = targetScore.split('.');
                    console.log(firstDigit);
                      if(firstDigit.length>1){
                        for(var i=0; i<firstDigit[0]; i++){
                          $this.find('.star1').eq(i).css({width:'100%'});
                        }
                        $this.find('.star1').eq(firstDigit[0]).css({width:firstDigit[1]+'0%'});
                      }else{
                        for(var i=0; i<targetScore; i++){
                          $this.find('.star1').eq(i).css({width:'100%'});
                        }
                      }
                });

              </script>
                        <!--  -->
                        <script>
      // JAVASCRIPT CODE
      const drawStar
       = (target) => {
        document.querySelector(`.star span`).style.width = `${
          target.value * 10
        }%`;
      };



<!--      checkbox-->

  $(document).ready(function() {
  const checkbox = $('#reviewList');
  const reviewImg = $('#reviewImg');
  const wrapReview = $('#wrapReview');

  reviewImg.hide();
  wrapReview.show();

  checkbox.change(function() {
    if($(this).is(':checked')) {
      reviewImg.show();
      wrapReview.hide();
    } else {
      reviewImg.hide();
      wrapReview.show();
    }
  });
});
      </script>
                      </div>
                      <!-- 점수 -->
                      <div class="point js-reviewGradeAvg" th:text="${avgStar}" >0.0</div>
                    </div>
                    <div class="reviewCount">
                      <strong th:text="${ listCount }">전체 리뷰 수</strong>
                      <strong >개의 리뷰가 있습니다</strong>
                    </div>
                  </div>
                  <!-- 구분선 빈박스 -->
                  <div class="bg-blank"></div>
                  <!-- 사진 후기 모아보기 -->
                  <div class="review_list_detail photo_review">
                    <div class="photo_check">
                      <input id="reviewList" type="checkbox" />
                      <span>사진 후기 모아보기(</span>
                      <span th:text="${listImgCount}" >0</span>
                      <span>)</span>
                    </div>
                    <div class="review-wrap gallary-list js-reviews">
                      <div class="txt-detail non js-reviewsEmpty">
                        <!--       사진 리뷰  -->
                        <div id="reviewImg">
                          <div class="main">
                            <div class="reviewBox">
                              <div class="item" th:each="dto,status:${ listImg }">
                                <div class="gradeWrap">
                                  <div class=" grade">
                                    <strong>평점</strong>
                                    <th:block th:switch="${ dto.reviewStar }" value="">
                                      <span th:case="1" class="gradeStar"><img src="https://image.makeshop.co.kr/mysoho/assets/shop/img/common/review_big_star_on.png"></span>
                                      <span th:case="2">
                                          <img src="https://image.makeshop.co.kr/mysoho/assets/shop/img/common/review_big_star_on.png">
                                          <img src="https://image.makeshop.co.kr/mysoho/assets/shop/img/common/review_big_star_on.png">
                                        </span>
                                      <span th:case="3" class="gradeStar">
                                          <img src="https://image.makeshop.co.kr/mysoho/assets/shop/img/common/review_big_star_on.png">
                                          <img src="https://image.makeshop.co.kr/mysoho/assets/shop/img/common/review_big_star_on.png">
                                          <img src="https://image.makeshop.co.kr/mysoho/assets/shop/img/common/review_big_star_on.png">
                                        </span>
                                      <span th:case="4" class="gradeStar">
                                          <img src="https://image.makeshop.co.kr/mysoho/assets/shop/img/common/review_big_star_on.png">
                                          <img src="https://image.makeshop.co.kr/mysoho/assets/shop/img/common/review_big_star_on.png">
                                          <img src="https://image.makeshop.co.kr/mysoho/assets/shop/img/common/review_big_star_on.png">
                                          <img src="https://image.makeshop.co.kr/mysoho/assets/shop/img/common/review_big_star_on.png">
                                        </span>
                                      <span th:case="5" class="gradeStar">
                                          <img src="https://image.makeshop.co.kr/mysoho/assets/shop/img/common/review_big_star_on.png">
                                          <img src="https://image.makeshop.co.kr/mysoho/assets/shop/img/common/review_big_star_on.png">
                                          <img src="https://image.makeshop.co.kr/mysoho/assets/shop/img/common/review_big_star_on.png">
                                          <img src="https://image.makeshop.co.kr/mysoho/assets/shop/img/common/review_big_star_on.png">
                                          <img src="https://image.makeshop.co.kr/mysoho/assets/shop/img/common/review_big_star_on.png">
                                        </span>
                                    </th:block>
                                  </div>

                                </div>
                                <div class="reviewContentWrap">
                                  <div th:if="${ dto.reviewImgUrl } != ''" >
                                    <img class="reviewImg" th:src="${ dto.reviewImgUrl }" >
                                  </div>
                                  <div th:text="${ dto.reviewContent }" class="reviewContent">
                                    내용
                                  </div>
                                </div>
                                <div class=" reviewInfo" >
                                  <div class="date" style="border-right: 1px solid #d6d6d6" th:text="${photoReviewIdList[status.index]}">
                                    작성자박선교
                                  </div>
                                  <div class="date" th:text="${#temporals.format(dto.reviewDatetime, 'yyyy-MM-dd HH:mm')}">
                                    등록일
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>          <!--      사진리뷰 끝 -->
                        <div id="wrapReview"> <!--      전체리뷰 -->
                          <div class="main">
                            <div class="reviewBox">

<!--                             작업중 -->
                                <div class="item" th:each="dto, status:${ list }">

                                  <div class="gradeWrap">
                                    <div class=" grade">
                                      <strong>평점</strong>
                                      <th:block th:switch="${ dto.reviewStar }" value="">
                                        <span th:case="1" class="gradeStar"><img src="https://image.makeshop.co.kr/mysoho/assets/shop/img/common/review_big_star_on.png"></span>
                                        <span th:case="2">
                                          <img src="https://image.makeshop.co.kr/mysoho/assets/shop/img/common/review_big_star_on.png">
                                          <img src="https://image.makeshop.co.kr/mysoho/assets/shop/img/common/review_big_star_on.png">
                                        </span>
                                        <span th:case="3" class="gradeStar">
                                          <img src="https://image.makeshop.co.kr/mysoho/assets/shop/img/common/review_big_star_on.png">
                                          <img src="https://image.makeshop.co.kr/mysoho/assets/shop/img/common/review_big_star_on.png">
                                          <img src="https://image.makeshop.co.kr/mysoho/assets/shop/img/common/review_big_star_on.png">
                                        </span>
                                        <span th:case="4" class="gradeStar">
                                          <img src="https://image.makeshop.co.kr/mysoho/assets/shop/img/common/review_big_star_on.png">
                                          <img src="https://image.makeshop.co.kr/mysoho/assets/shop/img/common/review_big_star_on.png">
                                          <img src="https://image.makeshop.co.kr/mysoho/assets/shop/img/common/review_big_star_on.png">
                                          <img src="https://image.makeshop.co.kr/mysoho/assets/shop/img/common/review_big_star_on.png">
                                        </span>
                                        <span th:case="5" class="gradeStar">
                                          <img src="https://image.makeshop.co.kr/mysoho/assets/shop/img/common/review_big_star_on.png">
                                          <img src="https://image.makeshop.co.kr/mysoho/assets/shop/img/common/review_big_star_on.png">
                                          <img src="https://image.makeshop.co.kr/mysoho/assets/shop/img/common/review_big_star_on.png">
                                          <img src="https://image.makeshop.co.kr/mysoho/assets/shop/img/common/review_big_star_on.png">
                                          <img src="https://image.makeshop.co.kr/mysoho/assets/shop/img/common/review_big_star_on.png">
                                        </span>
                                      </th:block>
                                    </div>

                                  </div>
                                  <div class="reviewContentWrap">
                                    <div th:if="${ dto.reviewImgUrl } != ''" >
                                      <img class="reviewImg" th:src="${ dto.reviewImgUrl }" >
                                    </div>
                                    <div th:text="${ dto.reviewContent }" class="reviewContent">
                                      내용
                                    </div>
                                  </div>
                                    <div class=" reviewInfo" >
                                      <div class="date" style="border-right: 1px solid #d6d6d6" th:text="${reviewIdList[status.index]}">
                                        작성자박선교
                                      </div>
                                      <div class="date" th:text="${#temporals.format(dto.reviewDatetime, 'yyyy-MM-dd HH:mm')}">
                                        등록일
                                      </div>
                                    </div>
                                </div>

                            </div>
                          </div>
                        </div>    <!--      전체리뷰 끝 -->
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!-- 문의 내용 (display none) -->
              <div class="page3">
                <div id="inquiryTab" class="tab-cont">
                  <div class="qa-btn-wrap">
                    <div class="btnBwrite js-btnMoveWritePage">
                      <a th:href="|/inquiry/productInquiryWriteForm/${dto.itemNo}?reference=/product/${dto.itemNo}|"
                        ><img
                          src="https://image.makeshop.co.kr/mysoho/assets/shop/img/btn/bg_ico_write.png"
                          alt=""
                        /><strong> 문의작성</strong></a
                      >
                    </div>
                  </div>

                <!-- 여기부터-->
                  <th:block th:each="dto2, status : ${inquiry}">

                    <!--로그인이면-->
                    <th:block sec:authorize="isAuthenticated()">
                      <div class="qa-list-wrap js-qnasArea" >
                        <div class="js-qnasArea qna-board-list"><!-- a태그였음-->
                          <!-- 답변이 없을 때 -->
                          <th:block th:if="${inReplyCount[status.index] ==0}">
                            <div class="qa-list-icon">
                              답변
                              <br />
                              대기
                            </div>
                          </th:block>
                          <th:block th:unless="${inReplyCount[status.index] ==0}">
                            <div class="qa-list-icon background-green">
                              답변
                              <br />
                              완료
                            </div>
                          </th:block>
                          <div class="tit-wrap js-qna">
                            <div >
                              <!--                          0303-->
                              <th:block th:if="${dto2.inquirySecret}=='비공개'">
                                <div class="tit js-qnaContents" >
                                  <th:blcok th:if="${LoginMemberId} == ${dto2.memberId}">
                                    <span class="txt_ellipsis" th:text="${dto2.inquiryContent}"></span>
                                  </th:blcok>
                                  <th:blcok th:unless="${LoginMemberId} == ${dto2.memberId}">
                                    <span> 비밀글입니다.</span>
                                    <img
                                            src="https://image.makeshop.co.kr/mysoho/assets/shop/img/common/ico_qa_lock.png"
                                            alt=""
                                            onclick="alert('작성자만 확인할 수 있습니다.')"
                                    />
                                  </th:blcok>
                                </div>
                              </th:block>
                              <th:block th:unless="${dto2.inquirySecret}=='비공개'">
                                <div class="tit js-qnaContents txt_ellipsis" th:text="${dto2.inquiryContent}"></div>
                              </th:block>
                              <div class="qna-info">
                                <div class="dil js-qnaType bar">상품문의</div>
                                <div class="name js-qnaWriter bar" th:text="${namelist[status.index]}">dl******...</div>
                                <div class="date js-qnaDate" th:text="${#temporals.format(dto2.inquiryDatetime, 'yyyy.MM.dd')}">2022.04.11</div>
                              </div>
                            </div>
                          </div>
                          <!--                      0303 지성 여기까지-->
                        </div><!-- a태그였음-->
                        <th:block th:if="${LoginMemberId} == ${dto2.memberId}">
                          <a th:href="|javascript:sortSelect(${status.count})|" class="threedot"
                          ><img
                                  src="https://image.makeshop.co.kr/mysoho/assets/shop/img/common/ico_review_md.png"
                                  alt=""
                          /></a>
                          <ul class="sort" th:id="|sort${status.count}|">
                            <li><a th:href="|/inquiry/modifyForm/${dto2.inquiryNo}?reference=/product/${dto.itemNo}|">수정</a></li>
                            <li>
                              <form action="#" th:action="@{/inquiry/delete/{id}(id=${dto2.inquiryNo})}" method="get" id="deleteBtn">
                                <button type="button" th:onclick="|javascript:checkDelete()|">삭제</button>
                              </form>
                            </li>
                          </ul>
                        </th:block>
                        <th:block th:unless="${LoginMemberId} == ${dto2.memberId}">
                        </th:block>

                      </div>
                    </th:block>
                    <!-- 2개양분할 -->
                    <!--로그인이아니면-->
                    <th:block sec:authorize="isAnonymous()">
                      <div class="qa-list-wrap js-qnasArea" >
                        <div class="js-qnasArea qna-board-list"><!-- a태그였음-->
                          <th:block th:if="${inReplyCount[status.index]}==0">
                            <div class="qa-list-icon">
                              답변
                              <br />
                              대기
                            </div>
                          </th:block>
                          <th:block th:unless="${inReplyCount[status.index]}==0">
                            <div class="qa-list-icon background-green">
                              답변
                              <br/>
                              완료
                            </div>
                          </th:block>
                          <div class="tit-wrap js-qna">
                            <div >
                              <th:block th:if="${dto2.inquirySecret}=='비공개'">
                                <div class="tit js-qnaContents" >
                                  <span>  비밀글입니다.</span>
                                  <img
                                          src="https://image.makeshop.co.kr/mysoho/assets/shop/img/common/ico_qa_lock.png"
                                          alt=""
                                          onclick="alert('작성자만 확인할 수 있습니다.')"
                                  />
                                </div>
                              </th:block>
                              <th:block th:unless="${dto2.inquirySecret}=='비공개'">
                                <div class="tit js-qnaContents txt_ellipsis" th:text="${dto2.inquiryContent}">문의합니다.</div>
                              </th:block>
                              <div class="qna-info">
                                <div class="dil js-qnaType bar">상품문의</div>
                                <div class="name js-qnaWriter bar" th:text="${namelist[status.index]}">dl******...</div>
                                <div class="date js-qnaDate" th:text="${#temporals.format(dto2.inquiryDatetime, 'yyyy.MM.dd')}">2022.04.11</div>
                              </div>
                            </div>
                          </div>
                          <!--                      0303 지성 여기까지-->
                        </div><!-- a태그였음-->
                        <th:block th:if="${LoginMemberId} == ${dto2.memberId}">
                          <a th:href="|javascript:sortSelect(${status.count})|" class="threedot"
                          ><img
                                  src="https://image.makeshop.co.kr/mysoho/assets/shop/img/common/ico_review_md.png"
                                  alt=""
                          /></a>
                          <ul class="sort" th:id="|sort${status.count}|">
                            <li><a th:href="|javascript:onCheckDiv(${status.count})|">수정</a></li></li>
                            <li><a th:href="|javascript:onCheckDiv2(${status.count})|">삭제</a></li>
                          </ul>
                        </th:block>
                        <th:block th:unless="${LoginMemberId} == ${dto2.memberId}">
                        </th:block>
                      </div>

                      <th:block sec:authorize="isAnonymous()">
                        <div class="CheckDiv" th:id="|CheckDiv${status.count}|" style="display:none;">
                          <form action="/inquiry/pw/check/action" method="post">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                            <input type="hidden" th:value="|/product/${dto.itemNo}|" name="reference">
                            <input type="hidden" th:value="${dto2.inquiryNo}" name="inquiryNo">
                            <input type="password" placeholder="비밀번호를 입력하세요." class="pwCheckInput" name="inquiryPassword">
                            <button type="submit" class="checkBtn">확인</button>
                          </form>
                        </div>
                        <div class="CheckDiv2" th:id="|CheckDiv2${status.count}|" style="display:none;">
                          <form action="/inquiry/pw/check/action2" method="post">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                            <input type="hidden" th:value="${dto2.inquiryNo}" name="inquiryNo">
                            <input type="password" placeholder="비밀번호를 입력하세요." class="pwCheckInput" name="inquiryPassword">
                            <button type="submit" class="checkBtn">확인</button>
                          </form>
                        </div>
                      </th:block>
                    </th:block>
                  </th:block>


              <!-- 여기까지-->
                </div>
              </div>

              <!-- 구분선 빈박스 -->
              <div class="bg-blank"></div>
              <form name="orderForm" action="/order/payAction" method="POST">
                <input
                  type="hidden"
                  th:name="${_csrf.parameterName}"
                  th:value="${_csrf.token}"
                />
                <!-- 주문자 정보 -->
                <div
                  th:replace="/user/order-object/container-shopping-basket-orderer.html :: container-shopping-basket-orderer"
                ></div>
                <!-- 적립금 -->
                <div
                  th:replace="/user/order-object/container-shopping-basket-mileage.html :: container-shopping-basket-mileage"
                ></div>
                <!-- 결제방법 -->
                <div
                  th:replace="/user/order-object/container-shopping-basket-payment.html :: container-shopping-basket-payment"
                ></div>
                <!-- 약관/결제 전체 동의 -->
                <div
                  th:replace="/user/order-object/container-shopping-basket-consent.html :: container-shopping-basket-consent"
                ></div>
                <!-- 결제요악 -->
                <div class="order-terms">
                  <div class="inner">
                    <div class="price-box">
                      <div class="between">
                        <div class="price-tit">총 상품금액</div>
                        <div>
                          <strong
                            class="price-tit-price"
                            id="finalTotalPrice"
                            data-th-text="${#numbers.formatInteger(dto.itemPrice, 3, 'COMMA')}+원"
                            >49,000원</strong
                          >
                          <th:block th:if="${dto.itemDiscountRate} != 0">
                            <input type="hidden" name="orderTotalPrice" id="finalTotalPriceInput" th:value="${ dto.itemDiscountPrice }" >
                          </th:block>
                          <th:block th:unless="${dto.itemDiscountRate} != 0">
                            <input type="hidden" name="orderTotalPrice" id="finalTotalPriceInput" th:value="${ dto.itemPrice }" >
                          </th:block>

                          <input type="hidden" name="orderTotalCount" id="orderTotalCount" value="1" >
                          <input type="hidden" name="itemCodeList" th:value="${ dto.itemNo }" />
<!--                          -->
                          <th:block th:if="${ sizeCount == 1} and ${ colorCount == 1}">
                            <input th:value="${ dto.itemOptionColor }" type="hidden" name="colorList" id="final-color-result">
                            <input th:value="${ dto.itemOptionSize }" type="hidden" name="sizeList" id="final-size-result">
                          </th:block>
                          <th:block th:unless="${ sizeCount == 1} and ${ colorCount == 1}">
                          <input type="hidden" name="colorList" id="final-color-result" >
                          <input type="hidden" name="sizeList" id="final-size-result" >
                          </th:block>
                        </div>
                      </div>
                      <div>
                        <div class="between mt-10 mb-6">
                          <div class="price-tit">총 배송비</div>
                          <div class="price-tit-price bold">+ 0원</div>
                        </div>
                        <div class="between h23">
                          <div class="price-text">- 기본 배송비</div>
                          <div class="price-text-price">
                            <span class="gray">(+)</span>0원
                          </div>
                        </div>
                        <div class="between h23">
                          <div class="price-text">- 지역 배송비</div>
                          <div class="price-text-price">
                            <span class="gray">(+)</span>0원
                          </div>
                        </div>
                      </div>
                      <div>
                        <div class="between mt-10 mb-6">
                          <div class="price-tit">총 할인/적립금 사용 금액</div>
                          <th:block th:if="${dto.itemDiscountRate} != 0">
                            <div
                              class="price-tit-price bold"
                              id="discountPrice"
                              data-th-text="'- '+${#numbers.formatInteger(dto.itemPrice-dto.itemDiscountPrice, 3, 'COMMA')}+원"
                            >
                              - 4,500원
                            </div>
                          </th:block>
                          <th:block th:unless="${dto.itemDiscountRate} != 0">
                            <div class="price-tit-price bold">- 0원</div>
                          </th:block>
                        </div>
                        <div class="between h23">
                          <div class="price-text">- 상품 할인</div>
                          <div class="price-text-price">
                            <th:block th:if="${dto.itemDiscountRate} != 0">
                              <span class="gray">(-)</span
                              ><span
                                id="discountPrice2"
                                data-th-text="${#numbers.formatInteger(dto.itemPrice-dto.itemDiscountPrice, 3, 'COMMA')}+원"
                                >4,500원</span
                              >
                            </th:block>
                            <th:block th:unless="${dto.itemDiscountRate} != 0">
                              <span class="gray">(-)</span>0원
                            </th:block>
                          </div>
                        </div>
                        <div class="between h23">
                          <div class="price-text">- 쿠폰 할인</div>
                          <div class="price-text-price">
                            <span class="gray">(-)</span>0원
                          </div>
                        </div>
                        <div class="between h23">
                          <div class="price-text">- 적립금 사용</div>
                          <div class="price-text-price">
                            <span class="gray">(-)</span>0원
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="pay-price">
                      <div class="between">
                        <div>
                          <strong>최종 주문금액</strong>
                        </div>
                        <div>
                          <th:block th:if="${dto.itemDiscountRate} != 0">
                            <strong
                              class="red2"
                              id="finalPrice"
                              data-th-text="${#numbers.formatInteger(dto.itemDiscountPrice, 3, 'COMMA')}+'원'"
                              >44,500원</strong
                            >
                          </th:block>
                          <th:block th:unless="${dto.itemDiscountRate} != 0">
                            <strong
                              class="red2"
                              id="finalPrice"
                              data-th-text="${#numbers.formatInteger(dto.itemPrice, 3, 'COMMA')}+'원'"
                              >44,500원</strong
                            >
                          </th:block>
                        </div>
                      </div>
                      <div class="left blue">
                        <span sec:authorize="isAnonymous()">
                            <strong
                            >(예상 적립금 <span>0</span>원, 비회원적립
                          불가)</strong
                            >
                        </span>
                        <input
                          type="hidden"
                          name="orderTotalPrice"
                          id="totalPriceInput"
                        />
                      </div>
                    </div>
                    <th:block th:if="${dto.itemSoldOut} != '품절'">
                      <button
                        type="button"
                        class="js-btnOrder js-mo-tpl btn-h42-gray mt-25"
                        onclick="processBeforeSubmit()"
                        >결제하기</button>
                    </th:block>
                    <th:block th:unless="${dto.itemSoldOut} != '품절'">
                      <button
                        type="button"
                        class="js-btnOrder js-mo-tpl btn-h42-gray mt-25"
                      >
                        품절</button
                      >
                    </th:block>
                    <div class="warning-labels-font">
                      <img
                        src="https://image.makeshop.co.kr/mysoho/assets/admin/images/common/m-notice-icon.png"
                        alt=""
                      />
                      마이소호는 통신판매 당사자가 아닙니다.
                      <br />
                      상품정보/주문/배송/환불 등 일체의 책임을 지지 않습니다.
                    </div>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>

      <!-- 푸터 -->
      <div class="footer">
        <div th:replace="/fragments/footer.html :: fragment-footer"></div>
      </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.3.min.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"
      integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"
      integrity="sha384-mQ93GR66B00ZXjt0YO5KlohRA5SY2XofN4zfuZxLkoj1gXtW8ANNCe9d5Y3eG5eD"
      crossorigin="anonymous"
    ></script>
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script src="/js/header.js"></script>
    <script src="/js/displayTypeChange.js"></script>
    <script src="/js/footer.js"></script>
    <script src="/js/popup.js"></script>
    <script src="/js/home-sort-btn.js"></script>
    <script src="/js/product-top1.js"></script>
    <script src="/js/shopping-basket.js"></script>
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script>
      let agree = document.querySelectorAll(".agree-box input");
      let agreeAllBtn = document.querySelector("#agreeAllBtn");

      let str = document.querySelector("#itemDiscountPrice").value;
      let price = Number(str);
      let temp = price;
      //기존 가격으로 토탈 초기화
      let totalPrice = temp;

      let strItemPrice = document.querySelector("#itemPrice").value;
      let price2 = Number(strItemPrice);
      let temp2 = price2;
      //기존 가격으로 토탈 초기화
      let totalPrice2 = temp2;

      var b = ",";
      var position = -3;
      let itemDiscountRate = document.querySelector("#itemDiscountRate").value;

      //상품 갯수
      let n = document.querySelector(".MSH-sto-stock").value;
      let tempN = n;
      let amount = tempN;

      function hiddenSizeTap() {
        document.querySelector(".hidden-option-tap").style.display = "none";
        document.querySelector(".option-total-price").innerHTML = 0;
        document.querySelector(".option-choice").style.display = "block";
        document.querySelector(".option-btn-bg").style.display = "block";
      }

      function buyBtn() {
        document.querySelector(".bg-option").className = "bg-option";
        document.querySelector(".order-frm").style.display = "block";
        let finalColorResult = document.querySelector(".final-color").innerHTML;
        let finalSizeResult = document.querySelector(".final-size").innerHTML;
        let productCount = document.querySelector(".MSH-sto-stock").value;
        document.querySelector(".final-size-result").innerHTML =
          finalSizeResult;
        document.querySelector(".final-color-result").innerHTML =
          finalColorResult;
        document.querySelector("#final-size-result").value =
          finalSizeResult;
        document.querySelector("#final-color-result").value =
          finalColorResult;
        document.querySelector("#product-count").innerHTML = productCount;
        document.querySelector("#hidden").style.display = "block";

        document.getElementById("order-first-input").focus();
      }

      function closeOptionList() {

        if (document.querySelector(".option-choice").style.display === "block") {
          document.querySelector("#hidden").style.display = "none";
        }else{
          let finalColorResult = document.querySelector(".final-color").innerHTML;
          let finalSizeResult = document.querySelector(".final-size").innerHTML;
          let productCount = document.querySelector(".MSH-sto-stock").value;
          document.querySelector(".final-size-result").innerHTML =
            finalSizeResult;
          document.querySelector(".final-color-result").innerHTML =
            finalColorResult;
          document.querySelector("#final-size-result").value =
            finalSizeResult;
          document.querySelector("#final-color-result").value =
            finalColorResult;
          document.querySelector("#product-count").innerHTML = productCount;
          document.querySelector("#hidden").style.display = "block";
        }
      }

      // 장바구니 쿠키생성
      function basketNumProduct(n) {
          if(n == 2 && document.querySelector("#hidden").style.display !== "block"
          && document.querySelector(".hidden-option-tap").style.display !== "block"){
            alert('옵션을 선택해주세요');
          }else{
            let itemNo = document.querySelector("#itemNo").value;
            let finalColorResult;
            let finalSizeResult;
            if (n == 1) {
              finalColorResult = document.querySelector("#itemOptionColor").value;
              finalSizeResult = document.querySelector("#itemOptionSize").value;
            } else if (n == 2) {
              finalColorResult = document.querySelector("#final-color").innerHTML;
              finalSizeResult = document.querySelector("#final-size").innerHTML;
            }
            let productCount = document.querySelector(".MSH-sto-stock").value;


            let cookieName = itemNo;
            cookieName += "." + finalColorResult;
            cookieName += "." + finalSizeResult;

            let cookieValue = Number(productCount); //아이템 수량으로 쿠키벨류 초기화
            basketNum += Number(cookieValue);
            document.querySelector(".basket-num").innerHTML = basketNum; //오른 숫자 반영

            if (getCookie("item_idx." + cookieName) == null) {
              //해당 상품이 쿠키로 만들어진적이 없으면 새로 생성하라는 뜻

              setCookie("item_idx." + cookieName, cookieValue);
            } else {
              let getCookieValue = getCookie("item_idx." + cookieName); //  getCookie("item_idx:" + item_idx) => value이다 "2"
              setCookie(
                "item_idx." + cookieName,
                Number(getCookieValue) + cookieValue
              ); //만약 같은 idx가 있으면 수량만 +1해서 기존 쿠키에 덮어씌운다.
              if (
                confirm(
                  "장바구니에 담긴 수량이 있어 수량이 추가되었습니다.\n \n 지금 확인하시겠습니까?"
                ) == true
              ) {
                location.href = "/order";
                //장바구니링크 추가 예정
              } else {
              }
            }
          }
      }
      var getCookie = function (cookieName) {
        let encodedCookieName = "";
        let splitedCookieName = cookieName.split(".");

        let encodedColor = encodeURIComponent(splitedCookieName[2]);
        for (let idx in splitedCookieName) {
          if (idx == 0) {
            encodedCookieName += splitedCookieName[idx];
          } else if (idx == 2) {
            encodedCookieName += "." + encodedColor;
          } else {
            encodedCookieName += "." + splitedCookieName[idx];
          }
        }

        //매개변수로 쿠키이름을 넣어주면 value로 반환
        var value = document.cookie.match(
          "(^|;) ?" + encodedCookieName + "=([^;]*)(;|$)"
        );
        return value ? value[2] : null; //3항 연산자 : 값이 있으면 가져오고 없으면 null로 반환
      };
    </script>
    <script th:inline="javascript">

      let checkList = [[${cartList}]];
      orderInit();
      ///////////////////////////////////////////////////////////////////////////////////////////////////
      /////////////////////////////////////// order init 관련 함수 ///////////////////////////////////////

      function orderInit(){

        if ([[${member}]] != null){

          document.getElementById("order-first-input").value = [[${member}]].memberName; // 주문자 정보 이름
          document.getElementById("orderRecipientPhone1").value = [[${member}]].memberPhone.substr(0,3); // 주문자 정보 전화번호 (앞 3자리)
          document.getElementById("order-sec-input").value = [[${member}]].memberPhone.substr(3); // 주문자 정보 전화번호 (뒷자리)
          document.getElementById("sample6_postcode").value = [[${member}]].memberAddrNumber; // 우편번호
          document.getElementById("sample6_address").value = [[${member}]].memberAddr1; // 기본주소
          document.getElementById("sample6_detailAddress").value = [[${member}]].memberAddr2; // 나머지주소
        }

      }

      /////////////////////////////////////////////////////////////////////////////////////////////////////
      /////////////////////////////////////// order submit 관련 함수 ///////////////////////////////////////
      function focusAlert(id){
          if(document.querySelector(".order-hd-open-1").style.display !== "none"){
            document.querySelector(".span1").style.display = "none";
            document.querySelector(".order-hd-open-1").style.display = "none";
            document.querySelector(".order-hd-close-1").style.display = "block";
            document.querySelector(".order1").style.display = "block";

            setTimeout(function(){document.getElementById(id).focus();}, 100);
          }else{
            setTimeout(function(){document.getElementById(id).focus();}, 100);
          }
        }

      function processBeforeSubmit(){
        let form = document.orderForm;

        // input 합치기
        combineInput();

        // valid한지 확인하기
        let alertString = checkValid();

        if (alertString == "success"){
          // cart input 만들기
          addCartInput();
          form.submit();
        }
        else if(alertString == "장바구니가 비었습니다.\n관심있는 상품을 담아보세요."){
          alert(alertString);
          location.href = "/";
        }else{
          alert(alertString);
          if(alertString == "주문자 이름을 2~5자의 한글로 입력해주세요."){
            focusAlert("order-first-input");
          }else if(alertString == "주문자 휴대폰 번호를 정확히 입력해주세요."){
            focusAlert("order-sec-input");
          }else if(alertString == "수령자 이름을 입력해주세요."){
            focusAlert("order-first-input-copy");
          }else if(alertString == "수령자 휴대폰 번호를 정확히 입력해주세요."){
            focusAlert("order-sec-input-copy");
          }else if(alertString == "수령자 주소를 정확히 입력해주세요."){
            focusAlert("sample6_postcode");
          }else if(alertString == "계좌번호를 선택해주세요."){
            focusAlert("paySelect");
          }else if(alertString == "옵션을 선택해 주세요."){
            focusAlert("MSH-prd-name");
          }
        }

      }

      function checkValid(){

        let checkId = /^[a-zA-z0-9]{4,12}$/; //아이디 유효성 검사
        let checkPW = /(?=.*[0-9])(?=.*[a-z])(?=.*\W)(?=\S+$).{8,20}/; //비밀번호 유효성 검사
        let checkName = /^[가-힣]{2,5}$/; //이름 유효성 검사
        let checkEmail = /^[A-Za-z0-9_\.\-]+@[A-Za-z0-9\-]+\.[A-Za-z0-9\-]+$/; //이메일 유효성 검사
        let checkPhone = /^[0-9]{10,11}$/; //이메일 유효성 검사

        if(document.querySelector("#final-size-result").value === '' || document.querySelector("#final-color-result").value === ''){
          return "옵션을 선택해 주세요."
        }

        // 주문자 정보 이름
        let orderName = document.getElementById("order-first-input").value;
        if (orderName == "" || !checkName.test(orderName)){
          return "주문자 이름을 2~5자의 한글로 입력해주세요."
        }

        // 주문자 정보 번호
        let orderPhoneBack = document.getElementById("order-sec-input").value;
        let orderPhone = document.getElementById("orderPhone").value;
        if (orderPhoneBack == "" || !checkPhone.test(orderPhone)){
          return "주문자 휴대폰 번호를 정확히 입력해주세요."
        }

        // 수령자 정보 이름
        let orderRecipientName = document.getElementById("order-first-input-copy").value;
        if (orderRecipientName == ""){
          return "수령자 이름을 입력해주세요."
        }

        // 수령자 정보 번호
        let orderRecipientPhoneBack = document.getElementById("order-sec-input-copy").value;
        let orderRecipientPhone = document.getElementById("orderRecipientPhone").value;
        if (orderRecipientPhoneBack == "" || !checkPhone.test(orderRecipientPhone)){
          return "수령자 휴대폰 번호를 정확히 입력해주세요."
        }

        // 수령자 주소 우편번호
        let orderRecipientAddrNumber = document.getElementById("sample6_postcode").value;
        if (orderRecipientAddrNumber == ""){
          return "수령자 주소를 정확히 입력해주세요."
        }

        // 수령자 주소 나머지 주소
        let orderRecipientAddr2 = document.getElementById("sample6_detailAddress").value;
        if (orderRecipientAddr2 == ""){
          return "수령자 주소를 정확히 입력해주세요."
        }

        // 무통장입금 계좌전호 선택
        let withoutBankbook = document.getElementById("pay2");
        let account = document.getElementById("paySelect");
        let selectedAccount = account.options[account.selectedIndex].value;
        if (withoutBankbook.checked && selectedAccount == ""){
          return "계좌번호를 선택해주세요."
        }


        // 약관 동의
        let consents = document.getElementsByName("terms_agree");

        for (let idx = 0; idx < consents.length; idx++){
          if (!consents[idx].checked && idx!=3){
            return "약관/결제 동의를 해주세요."
          }
        }

        // 회원가입 할 경우
        if ([[${member}]] == null && document.getElementById("joinCheckBox").checked){
          // 아이디
          let username = document.getElementById("username").value;
          if (username == "" || !checkId.test(username)){
           return "아이디를 정확히 입력해주세요."
          }

          // 이메일
          let memberEmail = document.getElementById("memberEmail").value;
          if (memberEmail == "" || !checkEmail.test(memberEmail)){
           return "이메일를 정확히 입력해주세요."
          }

          // 비밀번호
          let password = document.getElementById("check-txt-pw").value;
          if (password == "" || !checkPW.test(password)){
           return "비밀번호를 정확히 입력해주세요."
          }

          // 비밀번호 재입력
          let pwcheck = document.getElementById("check-txt-pwcheck").value;
          if (pwcheck != password){
           return "비밀번호 재입력칸을 확인해주세요."
          }
        }


        return "success";
      }

      function combineInput(){
        // memberName
        let orderName = document.getElementById("order-first-input").value;
        document.getElementById("memberName").value = orderName;

        // orderPhone
        let orderPhone1 = document.getElementById("orderPhone1").value;
        let orderPhone2 = document.getElementById("order-sec-input").value;
        document.getElementById("orderPhone").value = orderPhone1 + orderPhone2;

        // memberPhone
        let orderPhone = document.getElementById("orderPhone").value;
        document.getElementById("memberPhone").value = orderPhone;

        // orderRecipientPhone
        let orderRecipientPhone1 = document.getElementById("orderRecipientPhone1").value;
        let orderRecipientPhone2 = document.getElementById("order-sec-input-copy").value;
        document.getElementById("orderRecipientPhone").value = orderRecipientPhone1 + orderRecipientPhone2;

        // memberAddrNumber
        let orderRecipientAddrNumber = document.getElementById("sample6_postcode").value;
        document.getElementById("memberAddrNumber").value = orderRecipientAddrNumber;

        // memberAddr1
        let orderRecipientAddr1 = document.getElementById("sample6_address").value;
        document.getElementById("memberAddr1").value = orderRecipientAddr1;

        // memberAddr2
        let orderRecipientAddr2 = document.getElementById("sample6_detailAddress").value;
        document.getElementById("memberAddr2").value = orderRecipientAddr2;
      }

      function addCartInput(){
        let form = document.orderForm;

          // amount
          let inputAmount = document.createElement("input");
          inputAmount.setAttribute("type", "hidden");
          inputAmount.setAttribute("name", "amountList");
          inputAmount.setAttribute("value", document.getElementById("MSH-sto-stock").value);
          form.appendChild(inputAmount);

      }
    </script>

    <script>

  function sortSelect( count ) {

  if (document.querySelector("#sort"+count).style.display === "block") {
    document.querySelector("#sort"+count).style.display = "none";
  } else {
    document.querySelector("#sort"+count).style.display = "block";
  }
}

function onCheckDiv( number ) {

  if (document.querySelector("#CheckDiv"+number).style.display === "none") {
    document.querySelector("#CheckDiv"+number).style.display = "block";
  } else {
    document.querySelector("#CheckDiv"+number).style.display = "none";
  }
}

function onCheckDiv2( number ) {

  if (document.querySelector("#CheckDiv2"+number).style.display === "none") {
    document.querySelector("#CheckDiv2"+number).style.display = "block";
  } else {
    document.querySelector("#CheckDiv2"+number).style.display = "none";
  }
}

<!--  function openPopUpInquiryModify(inquiryId) {-->
<!--  popup = window.open("/qna/modifyForm/"+qnaId);-->
<!--}-->
 function checkDelete() {
          let form =  document.querySelector('#deleteBtn');
          if (confirm("해당 Q&A를 삭제하겠습니까? 삭제 후 복구가 불가능합니다.")) {
            form.submit();
          } else {
            return false;
          }
      }

<!--  function openPopUpInquiryModify(inquiryNo) {-->
<!--  popup = window.open("/inquiry/modifyForm/"+inquiryNo);-->
<!--}-->
</script>
    <script>
      var ckeckId = /^[a-zA-z0-9_-]{5,20}$/;
      var id = document.querySelector("#username");
      id.addEventListener("keyup", function () {
        if (ckeckId.test(id.value)) {
          document.querySelector(".check-txt-id2").style.display = "none";
          document.querySelector(".check-txt-id3").style.display = "block";
        } else {
          document.querySelector(".check-txt-id2").style.display = "block";
          document.querySelector(".check-txt-id3").style.display = "none";
        }
      });

      var ckeckPW = /(?=.*[0-9])(?=.*[a-z])(?=.*\W)(?=\S+$).{8,20}/; //비밀번호 유효성 검사
      var pw = document.querySelector("#check-txt-pw");
      pw.addEventListener("keyup", function () {
        if (ckeckPW.test(pw.value)) {
          document.querySelector(".check-txt-pw2").style.display = "none";
          document.querySelector(".check-txt-pw3").style.display = "block";
        } else {
          document.querySelector(".check-txt-pw2").style.display = "block";
          document.querySelector(".check-txt-pw3").style.display = "none";
        }
      });

      var pw = document.getElementById("check-txt-pw");
      var pwcheck = document.getElementById("check-txt-pwcheck");
      pwcheck.addEventListener("keyup", function () {
        if (pw.value === pwcheck.value) {
          document.querySelector(".check-txt-pwcheck-same").style.display = "block";
          document.querySelector(".check-txt-pwcheck-not").style.display = "none";
        } else {
          document.querySelector(".check-txt-pwcheck-same").style.display = "none";
          document.querySelector(".check-txt-pwcheck-not").style.display = "block";
        }
      });

      var ckeckEmail = /^[A-Za-z0-9_\.\-]+@[A-Za-z0-9\-]+\.[A-Za-z0-9\-]+$/; //이메일 유효성 검사
      var email = document.querySelector("#memberEmail");
      email.addEventListener("keyup", function () {
        if (ckeckEmail.test(email.value)) {
          document.querySelector(".check-txt-email2").style.display = "none";
          document.querySelector(".check-txt-email3").style.display = "block";
        } else {
          document.querySelector(".check-txt-email2").style.display = "block";
          document.querySelector(".check-txt-email3").style.display = "none";
        }
      });
    </script>

  </body>
</html>
