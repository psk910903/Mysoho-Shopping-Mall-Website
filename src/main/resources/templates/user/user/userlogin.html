<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>마이소호 샘플샵</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <link rel="stylesheet" href="/css/header.css" />
    <link rel="stylesheet" href="/css/footer.css" />
    <link rel="stylesheet" href="/css/login.css" />
  </head>
  <body>

    <script src="https://code.jquery.com/jquery-3.6.3.min.js"></script>
<!--    <div class="wrap">-->
    <div class="betweenbtn">
      <div th:replace="/fragments/betweenbtn.html :: fragment-betweenbtn"></div>
    </div>
    <div class="betweenbtn2">
      <div th:replace="/fragments/betweenbtn2.html :: fragment-betweenbtn2"></div>
    </div>
      <div class="header">
        <div th:replace="/fragments/header.html :: fragment-header"></div>
      </div>
  <div th:if="${param.error}" >
    <script>
      alert('아이디/비밀번호를 확인해주세요.');
    </script>
  </div>
  <div th:if="${param.logout}">
    <script>
      alert('로그아웃했습니다.');
    </script>
  </div>
      <!-- 로그인 -->
      <div class="containerlogin">
        <div class="users-title-line-hd">
          <h2>로그인</h2>
        </div>
        <div class="users-cont">
          <form  method="post" action="/user/loginAction">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
            <input class="input-st01 users-login-input" type="text" name="username" value="" placeholder="아이디를 입력해 주세요."/>
            <input class="input-st01 users-login-input mt-10" type="password" name="password" value="" placeholder="비밀번호를 입력해 주세요."/>
<!--            <a href="myorder-list-user.html" -->
            <button type="submit" id="login" class="btn-h42-gray mt-10">로그인</button>
<!--            </a>-->
          </form>
          <ul class="find-line">
            <li>
              <button type="button" id="join" class="bar main-rink">
                <a href="/user/join"> 회원가입</a>
              </button>
            </li>
            <li>
              <button type="button" id="show" class="bar main-rink">
                아이디찾기
              </button>
              <div class="background">
                <div class="window">
                  <div class="popup">
                    <div class="popup-tit">
                      <h2 class="popup-tit">아이디 찾기</h2>
                      <!-- <button id="close">팝업닫기</button> -->
                      <a id="close">&times;</a>
                    </div>
                    <div class="users-cont">
                      <div class="users-cont-p">
                        <p>이름과 휴대폰 번호를 입력해주세요</p>
                      </div>

                      <form method="post" action="/find/id">
                        <input class="input-st01 users-login-input" type="text" name="memberName" placeholder="이름을 입력하세요"/>
                        <input class="input-st01 users-login-input mt-10" type="text" name="memberPhone" placeholder="전화번호를 입력하세요"/>
                        <button class="btn-h42-gray mt-10" type="submit">찾기</button>
                      </form>
                    </div>
                  </div>
                </div>
              </div>
            </li>
            <li>
              <button type="button" id="show2" class="main-rink">
                비밀번호찾기
              </button>
              <div class="background2">
                <div class="window">
                  <div class="popup">
                    <div class="popup-tit">
                      <h2>비밀번호 찾기</h2>
                      <!-- <button id="close2">팝업닫기</button> -->
                      <a id="close2">&times;</a>
                    </div>
                    <div class="users-cont">
                      <div class="users-cont-div">
                        <div>가입하신 이메일을 입력해주세요.</div>
                        <div>입력시 해당 이메일로 비밀번호 변경</div>
                        <div>가능한 링크를 보내드립니다.</div>
                      </div>

                      <form action="/find/password" method="post">
                        <input class="input-st01 users-login-input" type="email" name="getEmail" placeholder="이메일을 입력해주세요"/>
                        <button type="submit" class="btn-h42-gray mt-10" >발송하기
                        </button>
                      </form>
                    </div>
                  </div>
                </div>
              </div>
            </li>
          </ul>
          <div class="btn-h42-gray mt-40 mb-30">
            <a href="/myorder" class="btn-h42-gray">비회원 주문조회</a>
          </div>
        </div>
      </div>
      <!-- 푸터 -->
      <div class="footer">
        <div th:replace="/fragments/footer.html :: fragment-footer"></div>
      </div>
    </div>

    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"
      integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"
      integrity="sha384-mQ93GR66B00ZXjt0YO5KlohRA5SY2XofN4zfuZxLkoj1gXtW8ANNCe9d5Y3eG5eD"
      crossorigin="anonymous"
    ></script>
    <script src="/js/header.js"></script>
    <script src="/js/footer.js"></script>
    <script>
      //아이디 찾기
      function show() {
        document.querySelector(".background").className = "background show";
      }
      function close() {
        document.querySelector(".background").className = "background";
      }
      document.querySelector("#show").addEventListener("click", show);
      document.querySelector("#close").addEventListener("click", close);

      //비밀번호찾기
      function show2() {
        document.querySelector(".background2").className = "background2 show2";
      }
      function close2() {
        document.querySelector(".background2").className = "background2";
      }
      document.querySelector("#show2").addEventListener("click", show2);
      document.querySelector("#close2").addEventListener("click", close2);

    $('.modal').on('hidden.bs.modal', function (e) {
        console.log('modal close');
        $(this).find('form')[0].reset()
    });

    $("#checkEmail").click(function () {
        let userEmail = $("#userEmail").val();
        let userName = $("#userName").val();

        $.ajax({
            type: "GET",
            url: "/check/findPw",
            data: {
                "userEmail": userEmail,
                "userName": userName
            },
            success: function (res) {
                if (res['check']) {
                    swal("발송 완료!", "입력하신 이메일로 임시비밀번호가 발송되었습니다.", "success").then((OK) => {
                        if(OK) {
                            $.ajax({
                                type: "POST",
                                url: "/check/findPw/sendEmail",
                                data: {
                                    "userEmail": userEmail,
                                    "userName": userName
                                }
                            })
                            window.location = "/login";
                        }
                    }
                )
                    $('#checkMsg').html('<p style="color:darkblue"></p>');
                } else {
                    $('#checkMsg').html('<p style="color:red">일치하는 정보가 없습니다.</p>');
                }
            }
        })
    })
    </script>
  </body>
</html>
